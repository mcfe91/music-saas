TODO:
Clean up error handling
Add unit tests
Add integration tests
Add functional tests